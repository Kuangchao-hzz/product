webpackJsonp([23],{1851:function(e,r,t){function a(e){t(2075)}var o=t(121)(t(2017),t(2124),a,null,null);e.exports=o.exports},2017:function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a=t(124),o=t.n(a),s=t(380);r.default={data:function(){return{dialogTitle:"新增用户",tableData:[],roleList:[],defaultCheckedKeys:[],addUserForm:{id:"0",employeeId:"",realName:"",phone:"",remark:"",areaIds:[],roleIds:[],addUserIsShow:!1,treeDialog:{type:!1,name:"",routerAuth:[],checkedValue:[]}},defaultProps:{children:"children",label:"label"},countryText:[],rules:{employeeId:[{required:!0,message:"请输入工号",trigger:"blur"}],realName:[{required:!0,message:"请输入姓名",trigger:"blur"}],phone:[{required:!0,message:"请输入联系方式",trigger:"blur"}],remark:[{required:!0,message:"请输入备注",trigger:"blur"}],roleIds:[{type:"array",required:!0,message:"请选择角色",trigger:"blur"}],"treeDialog.checkedValue":[{type:"array",required:!0,message:"请选择区域",trigger:"change"}]}}},computed:{treeCountry:function(){return this.addUserForm.treeDialog.routerAuth},handlerCountryText:function(){return this.countryText.join("/")},defaultCheckedData:function(){return this.defaultCheckedKeys},tabHeight:function(){return this.$store.state.include.tableHeight-255},currentUserNo:function(){return localStorage.getItem("ms_username")}},mounted:function(){this.data_table(),this.data_systemUserRoleList()},methods:{btn_auth:function(e){return this.$store.state.user.AUTHIDS.split(",").some(function(r){return r===e})},handleClose:function(e){this.addUserForm.id="",this.addUserForm.employeeId="",this.addUserForm.realName="",this.addUserForm.phone="",this.addUserForm.remark="",this.addUserForm.roleIds=[],this.addUserForm.roleIds=[],this.addUserForm.addUserIsShow=!1,this.$refs.addUserForm.resetFields(),this.addUserForm.treeDialog={type:!1,name:"",routerAuth:this.$store.state.select.treeCountry},this.$refs.tree.setCheckedKeys([])},submitForm:function(){var e=this;this.$refs.tree.getCheckedNodes().forEach(function(r,t){e.addUserForm.area.push(r.id)})},data_table:function(){var e=this;s.a.data_systemUserAll().then(function(r){e.tableData=r.data.dat})},handler_dataTableLock:function(e,r){var t=this,a=1===r?"你确定解冻该用户?":"你确定冻结该用户?";swal({title:a,type:"warning",showCancelButton:!0,reverseButtons:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"确定!",cancelButtonText:"取消"}).then(function(){s.a.edit_systemUserHandlerLock({userId:e.id,lock:r}).then(function(){t.data_table(),t.$message("操作成功！")})},function(){})},handlerUserData_edit:function(e){var r=this;this.addUserForm.addUserIsShow=!0,this.get_allAreaAndStore();var t=this;t.$nextTick(function(){if(e.id){t.dialogTitle="编辑用户";var a=e.roleIds.split(",").map(function(e){return parseInt(e)}),o=e.areaIds.split("-").map(function(e){return parseInt(e)});r.$refs.tree.setCheckedKeys(o),r.defaultCheckedKeys=o,r.addUserForm.id=e.id,r.addUserForm.employeeId=e.employeeId,r.addUserForm.realName=e.realName,r.addUserForm.phone=e.phone,r.addUserForm.remark=e.remark,r.addUserForm.roleIds=a}else t.dialogTitle="新增用户",t.$refs.tree.setCheckedKeys([])})},handlerUserData_del:function(e){var r=this;swal({title:"你确定要删除该用户?",type:"warning",showCancelButton:!0,reverseButtons:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"确定!",cancelButtonText:"取消"}).then(function(){s.a.data_systemUserDel({userId:e}).then(function(e){r.data_table(),r.$message("操作成功！")})},function(){})},save_dataTable:function(){var e=this;new o.a(function(r){e.addUserForm.treeDialog.checkedValue=e.$refs.tree.getCheckedNodes(),r()}).then(function(r){e.$refs.addUserForm.validate(function(r){if(!r)return!1;var t=e.$refs.tree.getCheckedKeys().sort(function(e,r){return e-r});s.a.data_systemUserSave({id:e.addUserForm.id,employeeId:e.addUserForm.employeeId,realName:e.addUserForm.realName,phone:e.addUserForm.phone,remark:e.addUserForm.remark,areaIds:t.join("-"),roleIds:e.addUserForm.roleIds.join(",")}).then(function(r){e.data_table(),e.handleClose(),e.$store.dispatch("fetch_allAreaAndStore"),e.$message("操作成功！")})})})},recursiveArea:function(e,r){var t=[];e.forEach(function(e){r.forEach(function(e){var r="";console.log(e),r+=e.id+"-",e.children&&e.children.length>0?e.children.forEach(function(e){r+=e.id+"-"}):t.push(r)})}),console.log(t)},data_systemUserRoleList:function(){var e=this;s.a.data_systemUserRoleList().then(function(r){1===r.data.code&&(e.roleList=r.data.dat)})},get_allAreaAndStore:function(){var e=this;return new o.a(function(r){s.a.fetch_allAreaAndStore().then(function(t){e.addUserForm.treeDialog.routerAuth=t.data.dat,r()})})}},watch:{"this.addUserForm.addUserIsShow":function(){console.log(this.addUserForm.addUserIsShow),this.addUserForm.addUserIsShow&&this.get_allAreaAndStore()}}}},2038:function(e,r,t){r=e.exports=t(1819)(!0),r.push([e.i,".view-user .user-group{margin-bottom:20px}.view-user .area-box .el-tree{height:200px;overflow-y:auto;border:1px solid #ddd;border-radius:4px}","",{version:3,sources:["D:/www.github.com/project/product/src/components/manage-system/childrens/user.vue"],names:[],mappings:"AACA,uBACE,kBAAoB,CACrB,AACD,8BACE,aAAc,AACd,gBAAiB,AACjB,sBAAuB,AACvB,iBAAmB,CACpB",file:"user.vue",sourcesContent:["\n.view-user .user-group {\n  margin-bottom: 20px;\n}\n.view-user .area-box .el-tree {\n  height: 200px;\n  overflow-y: auto;\n  border: 1px #ddd solid;\n  border-radius: 4px;\n}\n"],sourceRoot:""}])},2075:function(e,r,t){var a=t(2038);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);t(1820)("01855cd2",a,!0)},2124:function(e,r){e.exports={render:function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("div",{staticClass:"view-user"},[t("div",{staticClass:"user-group"},[t("el-button",{attrs:{disabled:!e.btn_auth("b_yh_xzyh")},on:{click:e.handlerUserData_edit}},[e._v("新增用户")])],1),e._v(" "),t("div",{staticClass:"system-user-table"},[t("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.tableData,height:e.tabHeight,"max-height":e.tabHeight,border:"","tooltip-effect":"dark"}},[t("el-table-column",{attrs:{prop:"employeeId",align:"center",label:"员工号"}}),e._v(" "),t("el-table-column",{attrs:{prop:"realName",align:"center",label:"姓名"}}),e._v(" "),t("el-table-column",{attrs:{prop:"phone",align:"center",label:"联系方式","show-overflow-tooltip":""}}),e._v(" "),t("el-table-column",{attrs:{prop:"roleNames",align:"center",label:"角色","show-overflow-tooltip":""}}),e._v(" "),t("el-table-column",{attrs:{prop:"remark",align:"center",label:"备注","show-overflow-tooltip":""}}),e._v(" "),t("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(r){return[e.currentUserNo!==r.row.employeeId?t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){e.handlerUserData_edit(r.row)}}},[e._v("编辑")]):e._e(),e._v(" "),1===r.row.isEnabled&&e.currentUserNo!==r.row.employeeId?t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){e.handler_dataTableLock(r.row,1)}}},[e._v("冻结")]):e._e(),e._v(" "),0===r.row.isEnabled&&e.currentUserNo!==r.row.employeeId?t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){e.handler_dataTableLock(r.row,0)}}},[e._v("解冻")]):e._e(),e._v(" "),e.currentUserNo!==r.row.employeeId?t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){e.handlerUserData_del(r.row.id)}}},[e._v("删除")]):e._e()]}}])})],1)],1),e._v(" "),t("el-dialog",{attrs:{title:e.dialogTitle,visible:e.addUserForm.addUserIsShow,size:"small","before-close":e.handleClose},on:{"update:visible":function(r){e.addUserForm.addUserIsShow=r}}},[t("el-form",{ref:"addUserForm",attrs:{model:e.addUserForm,rules:e.rules,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"工号: ",prop:"employeeId"}},[t("el-input",{model:{value:e.addUserForm.employeeId,callback:function(r){e.addUserForm.employeeId=r},expression:"addUserForm.employeeId"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"姓名: ",prop:"realName"}},[t("el-input",{model:{value:e.addUserForm.realName,callback:function(r){e.addUserForm.realName=r},expression:"addUserForm.realName"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"手机号: ",prop:"phone"}},[t("el-input",{model:{value:e.addUserForm.phone,callback:function(r){e.addUserForm.phone=r},expression:"addUserForm.phone"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"备注",prop:"remark"}},[t("el-input",{attrs:{type:"textarea"},model:{value:e.addUserForm.remark,callback:function(r){e.addUserForm.remark=r},expression:"addUserForm.remark"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"角色: ",prop:"roleIds"}},[t("el-checkbox-group",{model:{value:e.addUserForm.roleIds,callback:function(r){e.addUserForm.roleIds=r},expression:"addUserForm.roleIds"}},e._l(e.roleList,function(r,a){return t("el-checkbox",{key:a,attrs:{label:r.val,name:"roleList"}},[e._v(e._s(r.label))])}))],1),e._v(" "),t("el-form-item",{staticClass:"area-box",attrs:{label:"选择区域: ",prop:"treeDialog.checkedValue"}},[t("el-tree",{ref:"tree",attrs:{data:this.treeCountry,"show-checkbox":"","node-key":"id","default-expanded-keys":e.defaultCheckedData,props:e.defaultProps}})],1),e._v(" "),t("el-form-item",{staticStyle:{margin:"0","text-align":"right"}},[t("el-button",{on:{click:e.handleClose}},[e._v("取消")]),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:e.save_dataTable}},[e._v("确定")])],1)],1)],1)],1)},staticRenderFns:[]}}});
//# sourceMappingURL=23.510ec0442d282ebd1494.js.map